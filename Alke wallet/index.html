<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alke Wallet - Prototipo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
<!-- Barra de navegación (presente en todas las páginas excepto login) -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
  <div class="container">
    <a class="navbar-brand" href="menu.html">
      <i class="fas fa-wallet me-2"></i>Alke Wallet
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link" href="menu.html">Inicio</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="transactions.html">Movimientos</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="deposit.html">Depositar</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="sendmoney.html">Enviar Dinero</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="logoutBtn">Cerrar Sesión</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Contenido principal que cambiará según la página -->
<main id="main-content" class="container my-4">
  <!-- Página de Login (index.html) -->
  <div id="login-page" class="page">
    <div class="login-container">
      <h2 class="text-center mb-4">Iniciar Sesión</h2>
      <form id="loginForm">
        <div class="mb-3">
          <label for="email" class="form-label">Correo Electrónico</label>
          <input type="email" class="form-control" id="email" required>
        </div>
        <div class="mb-3">
          <label for="password" class="form-label">Contraseña</label>
          <input type="password" class="form-control" id="password" required>
        </div>
        <div class="d-grid">
          <button type="submit" class="btn btn-primary">Ingresar</button>
        </div>
      </form>
      <div class="alert alert-danger mt-3 d-none" id="loginError">
        Credenciales incorrectas. Intente nuevamente.
      </div>
    </div>
  </div>

  <!-- Página del Menú Principal (menu.html) -->
  <div id="menu-page" class="page d-none">
    <div class="row">
      <div class="col-md-8">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Resumen de Cuenta</h5>
            <p class="balance">$<span id="currentBalance">1,250.75</span></p>
            <p class="text-muted">Saldo disponible</p>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="card text-center h-100">
              <div class="card-body">
                <i class="fas fa-paper-plane menu-icon"></i>
                <h5 class="card-title">Enviar Dinero</h5>
                <p class="card-text">Realiza transferencias a otros usuarios</p>
                <a href="sendmoney.html" class="btn btn-primary">Enviar</a>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card text-center h-100">
              <div class="card-body">
                <i class="fas fa-download menu-icon"></i>
                <h5 class="card-title">Depositar</h5>
                <p class="card-text">Agrega fondos a tu cuenta</p>
                <a href="deposit.html" class="btn btn-success">Depositar</a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Últimos Movimientos</h5>
            <div id="recentTransactions">
              <!-- Las transacciones se cargarán dinámicamente -->
            </div>
            <a href="transactions.html" class="btn btn-outline-primary btn-sm mt-2">Ver todos</a>
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Contactos Frecuentes</h5>
            <div id="frequentContacts">
              <!-- Los contactos se cargarán dinámicamente -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Página de Enviar Dinero (sendmoney.html) -->
  <div id="sendmoney-page" class="page d-none">
    <div class="row">
      <div class="col-md-8">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Enviar Dinero</h5>
            <form id="sendMoneyForm">
              <div class="mb-3 search-box">
                <label for="contactSearch" class="form-label">Buscar Contacto</label>
                <input type="text" class="form-control" id="contactSearch" placeholder="Nombre o email del contacto">
                <div class="search-results" id="searchResults"></div>
              </div>
              <div class="mb-3">
                <label for="amount" class="form-label">Monto</label>
                <input type="number" class="form-control" id="amount" min="1" step="0.01" required>
              </div>
              <div class="mb-3">
                <label for="description" class="form-label">Descripción</label>
                <textarea class="form-control" id="description" rows="3"></textarea>
              </div>
              <div class="d-grid">
                <button type="submit" class="btn btn-primary">Enviar Dinero</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Agregar Nuevo Contacto</h5>
            <form id="addContactForm">
              <div class="mb-3">
                <label for="contactName" class="form-label">Nombre</label>
                <input type="text" class="form-control" id="contactName" required>
              </div>
              <div class="mb-3">
                <label for="contactEmail" class="form-label">Email</label>
                <input type="email" class="form-control" id="contactEmail" required>
              </div>
              <div class="d-grid">
                <button type="submit" class="btn btn-success">Agregar Contacto</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Página de Depósito (deposit.html) -->
  <div id="deposit-page" class="page d-none">
    <div class="row justify-content-center">
      <div class="col-md-6">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Realizar Depósito</h5>
            <form id="depositForm">
              <div class="mb-3">
                <label for="depositAmount" class="form-label">Monto a Depositar</label>
                <input type="number" class="form-control" id="depositAmount" min="1" step="0.01" required>
              </div>
              <div class="mb-3">
                <label for="paymentMethod" class="form-label">Método de Pago</label>
                <select class="form-select" id="paymentMethod" required>
                  <option value="">Seleccione un método</option>
                  <option value="credit">Tarjeta de Crédito</option>
                  <option value="debit">Tarjeta de Débito</option>
                  <option value="transfer">Transferencia Bancaria</option>
                </select>
              </div>
              <div class="d-grid">
                <button type="submit" class="btn btn-success">Realizar Depósito</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Página de Últimos Movimientos (transactions.html) -->
  <div id="transactions-page" class="page d-none">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Últimos Movimientos</h5>
        <div id="allTransactions">
          <!-- Todas las transacciones se cargarán dinámicamente -->
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Modal para mostrar mensajes -->
<div class="modal fade" id="messageModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="messageModalTitle">Mensaje</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="messageModalBody">
        <!-- Contenido del mensaje -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Aceptar</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  // Datos de ejemplo para la aplicación
  const sampleTransactions = [
    { id: 1, type: 'sent', amount: -50.00, description: 'Transferencia a María López', date: '2023-06-15' },
    { id: 2, type: 'received', amount: 120.00, description: 'Pago de Juan Pérez', date: '2023-06-14' },
    { id: 3, type: 'deposit', amount: 200.00, description: 'Depósito inicial', date: '2023-06-10' },
    { id: 4, type: 'sent', amount: -35.50, description: 'Pago de servicios', date: '2023-06-08' }
  ];

  const sampleContacts = [
    { id: 1, name: 'María López', email: 'maria@example.com' },
    { id: 2, name: 'Juan Pérez', email: 'juan@example.com' },
    { id: 3, name: 'Carlos Rodríguez', email: 'carlos@example.com' },
    { id: 4, name: 'Ana García', email: 'ana@example.com' }
  ];

  // Estado de la aplicación
  let currentUser = null;
  let userBalance = 1250.75;
  let transactions = [...sampleTransactions];
  let contacts = [...sampleContacts];

  // Funciones para gestionar la navegación
  function showPage(pageId) {
    $('.page').addClass('d-none');
    $(`#${pageId}`).removeClass('d-none');
  }

  // Inicialización de la aplicación
  $(document).ready(function() {
    // Verificar si el usuario está logueado
    const savedUser = localStorage.getItem('alkeWalletUser');
    if (savedUser) {
      currentUser = JSON.parse(savedUser);
      showPage('menu-page');
    } else {
      showPage('login-page');
    }

    // Cargar datos iniciales
    loadRecentTransactions();
    loadFrequentContacts();
    loadAllTransactions();

    // Configurar eventos
    setupEventHandlers();
  });

  // Configuración de manejadores de eventos
  function setupEventHandlers() {
    // Login
    $('#loginForm').on('submit', function(e) {
      e.preventDefault();
      const email = $('#email').val();
      const password = $('#password').val();

      // Validación simple (en un caso real, esto sería una llamada a un servidor)
      if (email && password) {
        currentUser = { email, name: 'Usuario Demo' };
        localStorage.setItem('alkeWalletUser', JSON.stringify(currentUser));
        showPage('menu-page');
        updateBalanceDisplay();
      } else {
        $('#loginError').removeClass('d-none');
      }
    });

    // Logout
    $('#logoutBtn').on('click', function() {
      currentUser = null;
      localStorage.removeItem('alkeWalletUser');
      showPage('login-page');
      $('#loginForm')[0].reset();
    });

    // Enviar dinero
    $('#sendMoneyForm').on('submit', function(e) {
      e.preventDefault();
      const amount = parseFloat($('#amount').val());
      const description = $('#description').val();

      if (amount > userBalance) {
        showMessage('Error', 'Saldo insuficiente para realizar esta transacción.');
        return;
      }

      // Actualizar saldo
      userBalance -= amount;
      updateBalanceDisplay();

      // Agregar transacción
      const newTransaction = {
        id: transactions.length + 1,
        type: 'sent',
        amount: -amount,
        description: description || 'Transferencia sin descripción',
        date: new Date().toISOString().split('T')[0]
      };

      transactions.unshift(newTransaction);
      loadRecentTransactions();
      loadAllTransactions();

      // Mostrar mensaje de éxito
      showMessage('Éxito', `Has enviado $${amount.toFixed(2)} correctamente.`);

      // Limpiar formulario
      $(this)[0].reset();
    });

    // Agregar contacto
    $('#addContactForm').on('submit', function(e) {
      e.preventDefault();
      const name = $('#contactName').val();
      const email = $('#contactEmail').val();

      // Verificar si el contacto ya existe
      const existingContact = contacts.find(contact =>
        contact.email.toLowerCase() === email.toLowerCase()
      );

      if (existingContact) {
        showMessage('Aviso', 'Este contacto ya existe en tu lista.');
        return;
      }

      // Agregar nuevo contacto
      const newContact = {
        id: contacts.length + 1,
        name,
        email
      };

      contacts.push(newContact);
      loadFrequentContacts();

      // Mostrar mensaje de éxito
      showMessage('Éxito', `Contacto "${name}" agregado correctamente.`);

      // Limpiar formulario
      $(this)[0].reset();
    });

    // Realizar depósito
    $('#depositForm').on('submit', function(e) {
      e.preventDefault();
      const amount = parseFloat($('#depositAmount').val());
      const paymentMethod = $('#paymentMethod').val();

      // Actualizar saldo
      userBalance += amount;
      updateBalanceDisplay();

      // Agregar transacción
      const newTransaction = {
        id: transactions.length + 1,
        type: 'deposit',
        amount: amount,
        description: `Depósito via ${getPaymentMethodName(paymentMethod)}`,
        date: new Date().toISOString().split('T')[0]
      };

      transactions.unshift(newTransaction);
      loadRecentTransactions();
      loadAllTransactions();

      // Mostrar mensaje de éxito
      showMessage('Éxito', `Has depositado $${amount.toFixed(2)} correctamente.`);

      // Limpiar formulario
      $(this)[0].reset();
    });

    // Búsqueda de contactos con autocompletar
    $('#contactSearch').on('input', function() {
      const searchTerm = $(this).val().toLowerCase();
      const results = $('#searchResults');

      if (searchTerm.length < 2) {
        results.hide().empty();
        return;
      }

      const filteredContacts = contacts.filter(contact =>
        contact.name.toLowerCase().includes(searchTerm) ||
        contact.email.toLowerCase().includes(searchTerm)
      );

      results.empty();

      if (filteredContacts.length > 0) {
        filteredContacts.forEach(contact => {
          results.append(`
                            <div class="contact-item" data-contact-id="${contact.id}">
                                <strong>${contact.name}</strong><br>
                                <small class="text-muted">${contact.email}</small>
                            </div>
                        `);
        });

        // Configurar evento para seleccionar contacto
        $('.contact-item').on('click', function() {
          const contactId = $(this).data('contact-id');
          const contact = contacts.find(c => c.id === contactId);

          if (contact) {
            $('#contactSearch').val(contact.name);
            results.hide();
          }
        });

        results.show();
      } else {
        results.hide();
      }
    });

    // Cerrar resultados de búsqueda al hacer clic fuera
    $(document).on('click', function(e) {
      if (!$(e.target).closest('.search-box').length) {
        $('#searchResults').hide();
      }
    });
  }

  // Funciones auxiliares
  function loadRecentTransactions() {
    const container = $('#recentTransactions');
    container.empty();

    const recent = transactions.slice(0, 3);

    if (recent.length === 0) {
      container.append('<p class="text-muted">No hay transacciones recientes</p>');
      return;
    }

    recent.forEach(transaction => {
      const amountClass = transaction.amount > 0 ? 'positive' : 'negative';
      const amountSign = transaction.amount > 0 ? '+' : '';

      container.append(`
                    <div class="transaction-item">
                        <div class="d-flex justify-content-between">
                            <div>
                                <strong>${transaction.description}</strong><br>
                                <small class="text-muted">${transaction.date}</small>
                            </div>
                            <div class="${amountClass}">
                                ${amountSign}$${Math.abs(transaction.amount).toFixed(2)}
                            </div>
                        </div>
                    </div>
                `);
    });
  }

  function loadAllTransactions() {
    const container = $('#allTransactions');
    container.empty();

    if (transactions.length === 0) {
      container.append('<p class="text-muted">No hay transacciones</p>');
      return;
    }

    transactions.forEach(transaction => {
      const amountClass = transaction.amount > 0 ? 'positive' : 'negative';
      const amountSign = transaction.amount > 0 ? '+' : '';
      const icon = transaction.amount > 0 ? 'fa-arrow-down' : 'fa-arrow-up';
      const iconClass = transaction.amount > 0 ? 'text-success' : 'text-danger';

      container.append(`
                    <div class="transaction-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center">
                                <i class="fas ${icon} ${iconClass} me-3"></i>
                                <div>
                                    <strong>${transaction.description}</strong><br>
                                    <small class="text-muted">${transaction.date}</small>
                                </div>
                            </div>
                            <div class="${amountClass} fw-bold">
                                ${amountSign}$${Math.abs(transaction.amount).toFixed(2)}
                            </div>
                        </div>
                    </div>
                `);
    });
  }

  function loadFrequentContacts() {
    const container = $('#frequentContacts');
    container.empty();

    const frequent = contacts.slice(0, 4);

    if (frequent.length === 0) {
      container.append('<p class="text-muted">No hay contactos</p>');
      return;
    }

    frequent.forEach(contact => {
      container.append(`
                    <div class="contact-item">
                        <div class="d-flex align-items-center">
                            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                                ${contact.name.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <strong>${contact.name}</strong><br>
                                <small class="text-muted">${contact.email}</small>
                            </div>
                        </div>
                    </div>
                `);
    });
  }

  function updateBalanceDisplay() {
    $('#currentBalance').text(userBalance.toFixed(2));
  }

  function getPaymentMethodName(method) {
    switch(method) {
      case 'credit': return 'Tarjeta de Crédito';
      case 'debit': return 'Tarjeta de Débito';
      case 'transfer': return 'Transferencia Bancaria';
      default: return 'Método desconocido';
    }
  }

  function showMessage(title, message) {
    $('#messageModalTitle').text(title);
    $('#messageModalBody').text(message);
    $('#messageModal').modal('show');
  }

  // Simulación de navegación entre páginas (en una aplicación real, estas serían páginas separadas)
  // Para propósitos de demostración, usamos enlaces con eventos
  $('a[href="menu.html"]').on('click', function(e) {
    e.preventDefault();
    showPage('menu-page');
  });

  $('a[href="transactions.html"]').on('click', function(e) {
    e.preventDefault();
    showPage('transactions-page');
  });

  $('a[href="deposit.html"]').on('click', function(e) {
    e.preventDefault();
    showPage('deposit-page');
  });

  $('a[href="sendmoney.html"]').on('click', function(e) {
    e.preventDefault();
    showPage('sendmoney-page');
  });
</script>
</body>
</html>
